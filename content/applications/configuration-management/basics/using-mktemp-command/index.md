---
slug: "Mastering Efficiency: Unleashing the Power of 'mktemp' Command"
description: 'Discover the ins and outs of harnessing the mktemp command on your Ubuntu 20.04 Utho server. Unlock the ability to effortlessly create temporary files and directories with this powerful tool'
keywords: ['mktemp', 'mktemp bash', 'mktemp directory', 'tmpdir']
tags: ['linux']
published: 2023-03-19
modified_by:
  name: Utho
title: "Crafting Temporal Magic: Mastering mktemp for File and Directory Creation"
title_meta: "Unlocking Efficiency: Mastering mktemp for Temporary File and Directory Creation"
authors: ["Pawan Kumar"]
---

The `mktemp` command, present in Linux and BSD operating systems, serves to create temporary files or directories. These temporary items can be customized using a user-defined "template." Notably, `mktemp` is a default utility across major Linux distributions.

In contrast to conventional methods like naming files using the process ID (PID) in scripts, `mktemp` offers a controlled naming convention within scripts. This minimizes the risk of accidental collisions with existing temporary files, thereby averting potential issues like unintentional file overwriting.

This guide elucidates the utility of `mktemp` directives and demonstrates how to employ templates for tailored file name generation.

## Exploring Practical Applications of Temporary Files and Directories in Linux

Temporary files generated by `mktemp` are owned by the user and are commonly utilized within scripts to store data among applications. A standard practice is to create these temporary files in the `/tmp` directory, which is automatically generated by the operating system.

It's important to note that `mktemp` operates differently from the `touch` command. While `mktemp` creates files or directories with flexibility, ensuring unique and randomly generated names, the touch command is typically used to modify the timestamp of a file and create permanent files. `mktemp` mitigates the risk of accidental overwrite or manipulation of existing files or directories.

Additionally, `mktemp` allows for the use of templates to define the naming structure of temporary files and directories, enabling customization in scripts or standalone invocations.

**Use Case #1 - Generating a Basic Temporary File**

When you use `mktemp` without any arguments, it generates a random file in the `/tmp` directory. By default, `/tmp` is where files are created unless you specify a different directory.

```command
mktemp
```
```output
/tmp/tmp.df8N4EE9Y
```

**Use Case #2 - Generating a Basic Temporary Directory**

Using `mktemp -d` to Generate a Temporary Directory in `/tmp`

```command
mktemp -d
```
```output
/tmp/tmp.df8N4EE9Y
```

When using the `mktemp` command, the default behavior is to generate a random name for the temporary file. However, you can customize this behavior by providing a template argument. This template must include a minimum of three 'X' characters, which serve as placeholders for random characters in the generated file name.

```command
tmp_dir=$(mktemp -d -t test-XXXX)
echo $tmp_dir
```
```output
/tmp/test-Xsd2ewsd
```

When you use the `mktemp` command, it locates the temporary directory based on the currently set environment variable `$TMPDIR`. For most shell scripts, the default value of $TMPDIR is either the `/tmp` directory or the /var/tmp directory.

It's worth noting the distinction between `/tmp` and `/var/tmp`: data stored in `/var/tmp` persists between reboots, making it more persistent than data in /tmp. Additionally, `/var/tmp` typically isn't affected by `systemctl` extensions that may manage temporary files.

### System Administrator Applications of mktemp

The `mktemp` command serves to explicitly designate files or directories as temporary. While the `/tmp` directory is commonly utilized for temporary files, it can pose issues in scenarios where multiple users or similar processes create files with the same filename. This can lead to conflicts requiring administrative intervention.

However, by leveraging `mktemp`, scripts can generate unique filenames that are unlikely to clash with existing ones. System administrators can employ `mktemp` in various ways:

- Creating temporary files and directories
- Testing the feasibility of temporary file and directory creation
- Generating file or directory names following a specific pattern with additional random characters
- Modifying the `TMPDIR` environmental variable to designate a custom directory other than the default `/tmp`, with an optional pattern
- Ensuring that temporary files and directories maintain ownership rights, safeguarding them from interference by other scripts, processes, or users causing filename collisions.

## Creating Temporary Files Using mktemp

The precise syntax for utilizing `mktemp` is outlined in the [man(mktemp) pages](https://man7.org/linux/man-pages/man3/mktemp.3.html). On most POSIX-compliant systems, the syntax remains consistent, as illustrated in the table below:

| Command                       | Description                                                                 |
| ----------------------------- |-----------------------------------------------------------------------------|
| `mktemp`                      | Makes a temporary file in the default temporary directory                   |
| `mktemp -V`                   | Display mktemp version then exit                                            |
| `mktemp -d`                   | Make a directory in the default temporary directory                 |
| `mktemp -p` <directory path>  | (implies `-t`) Uses the <directory path> as a prefix; the `-t` option generates a path in the default temporary directory (as specified by the environmental variable `$TMPDIR`).                                     |
| `mktemp -q`                   |  Perform execution of the command quietly, meaning without success or failure messages                                                                                                      |
| `mktemp -t`                   |  Make a temporary filename, using a template, to be located in `/tmp` directory unless the `$TMPDIR` directory exists, and if it exists, make the file in the directory specified by the `$TMPDIR` value             |

## Generating Temporary Directories with mktemp

When `mktemp` is used with the -d argument, it generates a directory within the /tmp directory. Alternatively, if the environmental variable $TMPDIR is defined, the directory is created within the specified `$TMPDIR` directory.

```command
mktemp -d
```
```output
/tmp/tmp.sdasdas
```
### Generating Temporary File Templates Using mktemp

A temporary file template allows for distinct naming of files based on specified criteria. In mktemp, the template utilizes the letter "X", which is substituted by a random character when the command is invoked. Up to ten consecutive "X" characters can be randomized in this manner.

In this command, "X" represents the placeholder for randomized characters, and you can include up to ten "X" characters to be replaced accordingly.

```command
mktemp -t random-XXXXXXXX
```
```output
/var/folders/gh/dbgxkdts6414dlmnflxbp2h80000gn/T/random-XXXXXXXX.4b5Dfmg4
```

The following command utilizes the -d argument with mktemp to create a directory in a similar fashion.

```command
mktemp -d random-XXXXXXXX
```
```output
random-13EL42PM
```

To view the newly created temporary directory, you can employ the `ls -la` command.

Additionally, you can append a suffix to a template when creating the directory, as demonstrated in the command below:

```command
mktemp -d --suffix TODAY
```
```output
/tmp/tmp.lmnflxbTODAY
```

## Understanding the TMPDIR Environment Variable

The TMPDIR environmental variable allows you to specify a different location for storing temporary files. It's part of a list accessible to applications and shell scripts. TMPDIR helps many applications identify the designated storage path for temporary directories, especially if it differs from the default location, typically /tmp. In some setups, /tmp might be placed on specialized media like an SSD for enhanced speed.

On certain Linux systems, the TMPDIR variable is managed by systemd-tempfiles, a daemon that can be configured to periodically clean files based on creation date or other attributes not covered here.

Changes made to the TMPDIR variable typically persist for the duration of the current user session or process ID (PID). Upon system reboot, the variable may revert to its default value, or as dictated by the systemd-tempfiles.conf file. Restarting a system, session, or any relevant event typically restores TMPDIR to its prior setting.

Using the mktemp --tmpdir argument adjusts the destination relative to the value specified by TMPDIR in the environment.

In the example command below, TMPDIR is set to a subdirectory, and mktemp generates its files in this new location:

```command
$TMPDIR=(mktemp -d)
```

Template and additional arguments can also be incorporated to modify the value of the `$TMPDIR` variable. Below is an example demonstrating the creation of a directory with date-coded naming:

```command
root@localhost:/home# tmpdir=$(mktemp -d -t ci-$(date +%Y-m-%d-%H-%M-%S)-XXXXXXXXXX)
root@localhost:/home# echo $tmpdir
```
```output
/var/folders/gh/dbgxkdts6414dlmnflxbp2h80000gn/T/ci-2022-m-28-22-46-25-XXXXXXXXXX.6lR6R7Az
```

## How to Delete Your Linux Systemâ€™s Temp Files

Cleaning up temporary files varies depending on the Linux distribution and version you're using. Modern Linux systems employing systemd typically utilize a mechanism called systemd-tempfiles for this purpose. However, specific configurations and processes for managing temporary files can differ based on the system's setup and implementation.

Regularly removing temporary files from the /tmp directory is considered a best practice as it prevents unnecessary disk space usage. Typically, files in the /tmp directory are cleared out by the system upon each reboot.

Note: Files stored in the /var/tmp directory are often retained between system reboots, providing a more persistent storage option compared to /tmp.

Below, we outline various methods for deleting temporary files from your system:

To clear the /tmp directory for the current user, assuming there are no active processes:

```command
rm -rf /tmp
```

This command recursively deletes all files and directories within /tmp, including subdirectories, and it forces the removal of files without prompting for confirmation. It's important to note that executing this command with root or sudo privileges can lead to the deletion of critical system files, potentially causing disruption. Therefore, it should be used with caution.

Another approach is to use the find command, which is available in most Linux distributions. This command allows you to search for files and directories based on specific criteria. For instance, the following find command locates and deletes all temporary files within the /tmp directory:

```command
sudo find /tmp -type f -delete
```

The `trap` command provides a way to handle the deletion of files created within a script. It ensures that designated temporary files are properly removed when the script finishes execution.

For instance, if your script generates a temporary file and you wish to ensure its deletion whenever the script terminates, you can incorporate a trap command at the beginning of your script to delete the file upon exit:

```file
tempfile=/tmp/tmpdata
trap "rm -f $tempfile" EXIT
```
